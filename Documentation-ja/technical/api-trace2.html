<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 9.1.1" />
<title>Trace2 API</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overridden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>Trace2 API</h1>
<span id="revdate">2023-07-22</span>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>Trace2 APIを使用して、デバッグ、パフォーマンス、およびテレメトリ情報をstderrまたはファイルに出力できます。 Trace2機能は、1つ以上のTrace2ターゲットを有効にして明示的に有効にしない限り、非アクティブです。</p></div>
<div class="paragraph"><p>Trace2 APIは、 既存の <code>GIT_TRACE</code> と <code>GIT_TRACE_PERFORMANCE</code> 機能によって提供される既存の (Trace1) <code>printf()</code> スタイルのトレースを置き換えることを目的としています。 初期実装時には、 Trace2とTrace1が並行して動作する場合があります。</p></div>
<div class="paragraph"><p>Trace2 APIは、 (<code>start</code>: <code>argv</code>) や (<code>exit</code>: {<code>exit-code</code>, <code>elapsed-time</code>}) などの既知のフィールドを持つ高レベルのメッセージのセットを定義します。</p></div>
<div class="paragraph"><p>Gitコードベース全体のTrace2計装(instrumentation)は、Trace2メッセージを有効なTrace2ターゲットに送信します。 ターゲットは、これらのメッセージコンテンツを目的固有の形式に変換し、データストリームにイベントを書き込みます。このように、Trace2 APIは、さまざまなタイプの分析を実行できます。</p></div>
<div class="paragraph"><p>ターゲットはVTableを使用して定義されるため、将来的に他の形式に簡単に拡張できます。 これは、たとえば、バイナリ形式を定義するために使用される場合があります。</p></div>
<div class="paragraph"><p>Trace2は、システムおよびグローバル構成ファイルの <code>trace2.*</code> 構成値と <code>GIT_TRACE2*</code> 環境変数を使用して制御されます。 Trace2 は、 リポジトリのローカルまたはワークツリー構成ファイルから読み取らず、 <code>-c</code> コマンド・ライン構成設定も尊重しません。</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_trace2_targets">Trace2 Targets</h2>
<div class="sectionbody">
<div class="paragraph"><p>Trace2は、以下のTrace2ターゲットのセットを定義します。フォーマットの詳細については、後のセクションで説明します。</p></div>
<div class="sect2">
<h3 id="_the_normal_format_target">The Normal Format Target</h3>
<div class="paragraph"><p>normal format ターゲットは、従来の <code>printf()</code> 形式であり、 GIT_TRACE形式に似ています。 この形式は、<code>GIT_TRACE2</code> 環境変数または、 <code>trace2.normalTarget</code> システム構成設定またはグローバル構成設定で有効になります。</p></div>
<div class="paragraph"><p>例えば</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ export GIT_TRACE2=~/log.normal
$ git version
git version 2.20.1.155.g426c96fcdb</code></pre>
</div></div>
<div class="paragraph"><p>または</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ git config --global trace2.normalTarget ~/log.normal
$ git version
git version 2.20.1.155.g426c96fcdb</code></pre>
</div></div>
<div class="paragraph"><p>これは下記を生成します</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ cat ~/log.normal
12:28:42.620009 common-main.c:38                  version 2.20.1.155.g426c96fcdb
12:28:42.620989 common-main.c:39                  start git version
12:28:42.621101 git.c:432                         cmd_name version (version)
12:28:42.621215 git.c:662                         exit elapsed:0.001227 code:0
12:28:42.621250 trace2/tr2_tgt_normal.c:124       atexit elapsed:0.001265 code:0</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_the_performance_format_target">The Performance Format Target</h3>
<div class="paragraph"><p>performance format target (PERF) は、 GIT_TRACE_PERFORMANCE に代わる列ベース(column-based)の形式であり、 開発とテストに適しており、 <code>gprof</code> などのツールを補完する可能性があります。 この形式は、 <code>GIT_TRACE2_PERF</code> 環境変数または、 <code>trace2.perfTarget</code> システム構成設定またはグローバル構成設定で有効になります。</p></div>
<div class="paragraph"><p>例えば</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ export GIT_TRACE2_PERF=~/log.perf
$ git version
git version 2.20.1.155.g426c96fcdb</code></pre>
</div></div>
<div class="paragraph"><p>または</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ git config --global trace2.perfTarget ~/log.perf
$ git version
git version 2.20.1.155.g426c96fcdb</code></pre>
</div></div>
<div class="paragraph"><p>これは下記を生成します</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ cat ~/log.perf
12:28:42.620675 common-main.c:38                  | d0 | main                     | version      |     |           |           |            | 2.20.1.155.g426c96fcdb
12:28:42.621001 common-main.c:39                  | d0 | main                     | start        |     |  0.001173 |           |            | git version
12:28:42.621111 git.c:432                         | d0 | main                     | cmd_name     |     |           |           |            | version (version)
12:28:42.621225 git.c:662                         | d0 | main                     | exit         |     |  0.001227 |           |            | code:0
12:28:42.621259 trace2/tr2_tgt_perf.c:211         | d0 | main                     | atexit       |     |  0.001265 |           |            | code:0</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_the_event_format_target">The Event Format Target</h3>
<div class="paragraph"><p>event format target は、テレメトリ分析に適したイベントデータのJSONベースの形式です。 この形式は、<code>GIT_TRACE2_EVENT</code> 環境変数または <code>trace2.eventTarget</code> システム構成設定またはグローバル構成設定で有効になります。</p></div>
<div class="paragraph"><p>例えば</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ export GIT_TRACE2_EVENT=~/log.event
$ git version
git version 2.20.1.155.g426c96fcdb</code></pre>
</div></div>
<div class="paragraph"><p>または</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ git config --global trace2.eventTarget ~/log.event
$ git version
git version 2.20.1.155.g426c96fcdb</code></pre>
</div></div>
<div class="paragraph"><p>これは下記を生成します</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ cat ~/log.event
{"event":"version","sid":"20190408T191610.507018Z-H9b68c35f-P000059a8","thread":"main","time":"2019-01-16T17:28:42.620713Z","file":"common-main.c","line":38,"evt":"3","exe":"2.20.1.155.g426c96fcdb"}
{"event":"start","sid":"20190408T191610.507018Z-H9b68c35f-P000059a8","thread":"main","time":"2019-01-16T17:28:42.621027Z","file":"common-main.c","line":39,"t_abs":0.001173,"argv":["git","version"]}
{"event":"cmd_name","sid":"20190408T191610.507018Z-H9b68c35f-P000059a8","thread":"main","time":"2019-01-16T17:28:42.621122Z","file":"git.c","line":432,"name":"version","hierarchy":"version"}
{"event":"exit","sid":"20190408T191610.507018Z-H9b68c35f-P000059a8","thread":"main","time":"2019-01-16T17:28:42.621236Z","file":"git.c","line":662,"t_abs":0.001227,"code":0}
{"event":"atexit","sid":"20190408T191610.507018Z-H9b68c35f-P000059a8","thread":"main","time":"2019-01-16T17:28:42.621268Z","file":"trace2/tr2_tgt_event.c","line":163,"t_abs":0.001265,"code":0}</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_enabling_a_target">Enabling a Target</h3>
<div class="paragraph"><p>ターゲットを有効にするには、対応する環境変数、システム、またはグローバル構成値を以下のいずれかに設定します:</p></div>
<div class="openblock">
<div class="content">
<div class="ulist"><ul>
<li>
<p>
<code>0</code> or <code>false</code> - ターゲットを無効にします。
</p>
</li>
<li>
<p>
<code>1</code> or <code>true</code> - <code>STDERR</code> に書き出します。
</p>
</li>
<li>
<p>
<code>[2-9]</code> - すでに開いているファイル・デスクリプターに書き出します。
</p>
</li>
<li>
<p>
<code>&lt;absolute-pathname&gt;</code> - appendモードでファイルに書き込みます。ターゲットがすでに存在し、ディレクトリである場合、トレースは指定のディレクトリの下のファイル(プロセスごとに1つ)に書き込まれます。
</p>
</li>
<li>
<p>
<code>af_unix:[&lt;socket_type&gt;:]&lt;absolute-pathname&gt;</code> - Unixドメインソケットに書き出します(それらをサポートするプラットフォーム上であれば)。ソケットタイプは <code>stream</code> または <code>dgram</code> のいずれかです。省略した場合、Gitは両方を試します。
</p>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p>トレースファイルがターゲットディレクトリに書き込まれるとき、それらはSIDの最後のコンポーネントに従って名前が付けられます(ファイル名の衝突を避けるために、オプションでカウンターが続きます)。</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_trace2_api">Trace2 API</h2>
<div class="sectionbody">
<div class="paragraph"><p>The Trace2 public API is defined and documented in <code>trace2.h</code>; refer to it for more information. All public functions and macros are prefixed with <code>trace2_</code> and are implemented in <code>trace2.c</code>.</p></div>
<div class="paragraph"><p>Trace2データ構造体は公開されていません。</p></div>
<div class="paragraph"><p>The Trace2 code also defines a set of private functions and data types in the <code>trace2/</code> directory. These symbols are prefixed with <code>tr2_</code> and should only be used by functions in <code>trace2.c</code> (or other private source files in <code>trace2/</code>).</p></div>
<div class="sect2">
<h3 id="_conventions_for_public_functions_and_macros_パブリック関数とマクロの規則">Conventions for Public Functions and Macros(パブリック関数とマクロの規則)</h3>
<div class="paragraph"><p>一部の関数には、 <code>file</code> と <code>line-number</code> 引数を取ることを示すために <code>_fl()</code> サフィックスが付いています。</p></div>
<div class="paragraph"><p>一部の関数には <code>_va_fl()</code> サフィックスが付いており、 <code>va_list</code> 引数も取ることが示されます。</p></div>
<div class="paragraph"><p>一部の関数には、 <code>_printf_fl()</code> 接尾辞が付いており、 可変数の引数を持つ <code>printf()</code> スタイルの形式も使用することを示しています。</p></div>
<div class="paragraph"><p>CPP wrapper macros are defined to hide most of these details.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_trace2_target_formats">Trace2 Target Formats</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_normal_format">NORMAL Format</h3>
<div class="paragraph"><p>イベントは、以下の形式の行として記述されます:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[&lt;time&gt; SP &lt;filename&gt;:&lt;line&gt; SP+] &lt;event-name&gt; [[SP] &lt;event-message&gt;] LF</code></pre>
</div></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>&lt;event-name&gt;</code>
</dt>
<dd>
<p>
        イベント名です。
</p>
</dd>
<dt class="hdlist1">
<code>&lt;event-message&gt;</code>
</dt>
<dd>
<p>
        人間が読むことを目的とした自由形式の <code>printf()</code> メッセージです。
</p>
<div class="paragraph"><p>注意: これには、エスケープされていない埋め込みLFまたはCRLF文字が含まれている可能性があるため、イベントが複数行に波及する可能性があることに注意してください。</p></div>
</dd>
</dl></div>
<div class="paragraph"><p><code>GIT_TRACE2_BRIEF</code> または <code>trace2.normalBrief</code> がtrueの場合、 <code>time</code> と <code>filename</code> と <code>line</code> フィールドは省略されます。</p></div>
<div class="paragraph"><p>このターゲットは、他のターゲットよりも要約的(GIT_TRACEなど)であり、詳細度の低さを目的としています。 たとえば、スレッド、リージョン、データメッセージは無視されます。</p></div>
</div>
<div class="sect2">
<h3 id="_perf_format">PERF Format</h3>
<div class="paragraph"><p>イベントは、以下の形式の行として記述されます:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[&lt;time&gt; SP &lt;filename&gt;:&lt;line&gt; SP+
    BAR SP] d&lt;depth&gt; SP
    BAR SP &lt;thread-name&gt; SP+
    BAR SP &lt;event-name&gt; SP+
    BAR SP [r&lt;repo-id&gt;] SP+
    BAR SP [&lt;t_abs&gt;] SP+
    BAR SP [&lt;t_rel&gt;] SP+
    BAR SP [&lt;category&gt;] SP+
    BAR SP DOTS* &lt;perf-event-message&gt;
    LF</code></pre>
</div></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>&lt;depth&gt;</code>
</dt>
<dd>
<p>
        gitプロセスの深さです。これは親gitプロセスの数です。トップレベルのgitコマンドの深さの値は「d0」です。その子プロセスの深さの値は「d1」です。2番目のレベルの子プロセスの深さの値は「d2」などです。
</p>
</dd>
<dt class="hdlist1">
<code>&lt;thread-name&gt;</code>
</dt>
<dd>
<p>
        スレッドの一意の名前です。 プライマリスレッドは「main」と呼ばれます。 他のスレッド名は「th%d:%s」の形式で、一意の番号とthread-procの名前が含まれています。
</p>
</dd>
<dt class="hdlist1">
<code>&lt;event-name&gt;</code>
</dt>
<dd>
<p>
        イベント名です。
</p>
</dd>
<dt class="hdlist1">
<code>&lt;repo-id&gt;</code>
</dt>
<dd>
<p>
        (存在する場合、)使用中のリポジトリを示す番号です。リポジトリが開かれると、 <code>def_repo</code> イベントが発行されます。これにより、リポジトリIDと関連するワークツリーが定義されます。後続のリポジトリ固有のイベントは、この repo-id を参照します。
</p>
<div class="paragraph"><p>現在、これはメインリポジトリの場合は常に「r1」です。 このフィールドは、将来の in-proc サブモジュールを見越したものです。</p></div>
</dd>
<dt class="hdlist1">
<code>&lt;t_abs&gt;</code>
</dt>
<dd>
<p>
        (存在する場合、)プログラムが開始されてからの絶対時間(秒単位)です。
</p>
</dd>
<dt class="hdlist1">
<code>&lt;t_rel&gt;</code>
</dt>
<dd>
<p>
        (存在する場合、)現在の領域(current region)の開始を基準にした秒単位の時間です。 thread-exitイベントの場合、これはスレッドの経過時間です。
</p>
</dd>
<dt class="hdlist1">
<code>&lt;category&gt;</code>
</dt>
<dd>
<p>
        リージョンおよびデータイベントに存在し、「index」や「status」などの幅広いカテゴリを表すために使用されます。
</p>
</dd>
<dt class="hdlist1">
<code>&lt;perf-event-message&gt;</code>
</dt>
<dd>
<p>
        人間が読むことを目的とした自由形式の <code>printf()</code> メッセージです。
</p>
</dd>
</dl></div>
<div class="listingblock">
<div class="content">
<pre><code>15:33:33.532712 wt-status.c:2310                  | d0 | main                     | region_enter | r1  |  0.126064 |           | status     | label:print
15:33:33.532712 wt-status.c:2331                  | d0 | main                     | region_leave | r1  |  0.127568 |  0.001504 | status     | label:print</code></pre>
</div></div>
<div class="paragraph"><p><code>GIT_TRACE2_PERF_BRIEF</code> または <code>trace2.perfBrief</code> がtrueの場合、 <code>time</code> と <code>file</code> と`line` フィールドは省略されます。</p></div>
<div class="listingblock">
<div class="content">
<pre><code>d0 | main                     | region_leave | r1  |  0.011717 |  0.009122 | index      | label:preload</code></pre>
</div></div>
<div class="paragraph"><p>PERFターゲットは、開発中の対話的なパフォーマンス分析を目的としており、非常にノイズが多いです。</p></div>
</div>
<div class="sect2">
<h3 id="_event_format">EVENT Format</h3>
<div class="paragraph"><p>各イベントは、複数のキーと値のペアを含むJSONオブジェクトで、1行で記述され、そして、その後にLFが続きます。</p></div>
<div class="listingblock">
<div class="content">
<pre><code>'{' &lt;key&gt; ':' &lt;value&gt; [',' &lt;key&gt; ':' &lt;value&gt;]* '}' LF</code></pre>
</div></div>
<div class="paragraph"><p>一部のキーと値のペアはすべてのイベントに共通であり、一部はイベント固有です。</p></div>
<div class="sect3">
<h4 id="_common_key_value_pairs">Common Key/Value Pairs</h4>
<div class="paragraph"><p>以下の、キーと値のペアは、すべてのイベントに共通です:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"version",
        "sid":"20190408T191827.272759Z-H9b68c35f-P00003510",
        "thread":"main",
        "time":"2019-04-08T19:18:27.282761Z",
        "file":"common-main.c",
        "line":42,
        ...
}</code></pre>
</div></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>"event":&lt;event&gt;</code>
</dt>
<dd>
<p>
        イベント名です。
</p>
</dd>
<dt class="hdlist1">
<code>"sid":&lt;sid&gt;</code>
</dt>
<dd>
<p>
        セッションIDです。これは、プロセスインスタンスを識別するための一意の文字列であり、プロセスによって発行されたすべてのイベントを識別できるようにします。 PIDはOSによってリサイクルされるため、PIDの代わりにセッションIDが使用されます。 子gitプロセスの場合、後処理中に親子関係を識別できるように、session-idの前に親gitプロセスのsession-idが追加されます。
</p>
</dd>
<dt class="hdlist1">
<code>"thread":&lt;thread&gt;</code>
</dt>
<dd>
<p>
        スレッド名です。
</p>
</dd>
<dt class="hdlist1">
<code>"time":&lt;time&gt;</code>
</dt>
<dd>
<p>
        イベントのUTC時刻です。
</p>
</dd>
<dt class="hdlist1">
<code>"file":&lt;filename&gt;</code>
</dt>
<dd>
<p>
        イベントを生成するソースファイルです。
</p>
</dd>
<dt class="hdlist1">
<code>"line":&lt;line-number&gt;</code>
</dt>
<dd>
<p>
        イベントを生成する整数のソース行番号です。
</p>
</dd>
<dt class="hdlist1">
<code>"repo":&lt;repo-id&gt;</code>
</dt>
<dd>
<p>
        存在する場合、前述の整数 repo-id です。
</p>
</dd>
</dl></div>
<div class="paragraph"><p><code>GIT_TRACE2_EVENT_BRIEF</code> または <code>trace2.eventBrief</code> がtrueの場合、 <code>file</code> と <code>line</code> フィールドはすべてのイベントから省略され、 <code>time</code> フィールドは "start" イベントと "atexit" イベントにのみ存在します。</p></div>
</div>
<div class="sect3">
<h4 id="_event_specific_key_value_pairs">Event-Specific Key/Value Pairs</h4>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>"version"</code>
</dt>
<dd>
<p>
        このイベントは、実行可能ファイルのバージョンとEVENT形式を提供します。 常にトレースセッションの最初のイベントである必要があります。 新しいイベントタイプが追加された場合、既存のフィールドが削除された場合、または既存のイベントまたはフィールドの解釈に大幅な変更があった場合、EVENT形式のバージョンがインクリメントされます。既存のイベントに新しいフィールドを追加するなどの小さな変更では、EVENT形式のバージョンを増やす必要はありません。
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"version",
        ...
        "evt":"3",                     # EVENT format version
        "exe":"2.20.1.155.g426c96fcdb" # git version
}</code></pre>
</div></div>
</dd>
<dt class="hdlist1">
<code>"too_many_files"</code>
</dt>
<dd>
<p>
        ターゲットトレースディレクトリにファイルが多すぎる場合、このイベントは git-trace2-discard センチネル(sentinel)ファイルに書き込まれます(trace2.maxFiles 構成オプションを参照)。
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"too_many_files",
        ...
}</code></pre>
</div></div>
</dd>
<dt class="hdlist1">
<code>"start"</code>
</dt>
<dd>
<p>
        このイベントには、 main() が受け取ったした完全なargvが含まれています。
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"start",
        ...
        "t_abs":0.001227, # elapsed time in seconds
        "argv":["git","version"]
}</code></pre>
</div></div>
</dd>
<dt class="hdlist1">
<code>"exit"</code>
</dt>
<dd>
<p>
        このイベントは、gitが <code>exit()</code> を呼び出すときに発生します。
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"exit",
        ...
        "t_abs":0.001227, # elapsed time in seconds
        "code":0          # exit code
}</code></pre>
</div></div>
</dd>
<dt class="hdlist1">
<code>"atexit"</code>
</dt>
<dd>
<p>
        このイベントは、最終シャットダウン中にTrace2の <code>atexit</code> ルーチンによって発行されます。これは、プロセスによって発行される最後のイベントである必要があります。
</p>
<div class="paragraph"><p>(ここで報告される経過時間(elapsed time)は、他のすべてのatexitタスクが完了した後に実行されるため、「exit」イベントで報告される時間よりも長くなります。)</p></div>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"atexit",
        ...
        "t_abs":0.001227, # elapsed time in seconds
        "code":0          # exit code
}</code></pre>
</div></div>
</dd>
<dt class="hdlist1">
<code>"signal"</code>
</dt>
<dd>
<p>
        このイベントは、プログラムがユーザーシグナルによって終了したときに発行されます。プラットフォームによっては、シグナルイベントによって「atexit」イベントの生成が妨げられる場合があります。
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"signal",
        ...
        "t_abs":0.001227,  # elapsed time in seconds
        "signo":13         # SIGTERM, SIGINT, etc.
}</code></pre>
</div></div>
</dd>
<dt class="hdlist1">
<code>"error"</code>
</dt>
<dd>
<p>
        このイベントは、 <code>BUG()</code>, <code>bug()</code>, <code>error()</code>, <code>die()</code>, <code>warning()</code>, <code>usage()</code> 関数のいずれかが呼び出されたときに発行されます。
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"error",
        ...
        "msg":"invalid option: --cahced", # formatted error message
        "fmt":"invalid option: %s"        # error format string
}</code></pre>
</div></div>
<div class="paragraph"><p>エラーイベントは複数回発生する可能性があります。フォーマット文字列を使用すると、ポストプロセッサは特定のエラー引数を気にすることなく、タイプごとにエラーをグループ化できます。</p></div>
</dd>
<dt class="hdlist1">
<code>"cmd_path"</code>
</dt>
<dd>
<p>
        このイベントには、git実行可能ファイルの検出されたフルパスが含まれています(それを解決するように構成されているプラットフォーム上で)。
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"cmd_path",
        ...
        "path":"C:/work/gfw/git.exe"
}</code></pre>
</div></div>
</dd>
<dt class="hdlist1">
<code>"cmd_ancestry"</code>
</dt>
<dd>
<p>
        このイベントには、現在のプロセスの親（および以前の世代の親）のテキストコマンド名が、最も近い親から最も遠い曽祖父母の順に配列で含まれています。 すべてのプラットフォームに実装されているとは限りません。
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"cmd_ancestry",
        ...
        "ancestry":["bash","tmux: server","systemd"]
}</code></pre>
</div></div>
</dd>
<dt class="hdlist1">
<code>"cmd_name"</code>
</dt>
<dd>
<p>
        このイベントには、このgitプロセスのコマンド名と、親gitプロセスからのコマンドの階層が含まれます。
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"cmd_name",
        ...
        "name":"pack-objects",
        "hierarchy":"push/pack-objects"
}</code></pre>
</div></div>
<div class="paragraph"><p>通常、「name」フィールドにはコマンドの正規名が含まれます。正規名が使用できない場合は、以下の特別な値のいずれかが使用されます:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>"_query_"            # "git --html-path"
"_run_dashed_"       # when "git foo" tries to run "git-foo"
"_run_shell_alias_"  # alias expansion to a shell command
"_run_git_alias_"    # alias expansion to a git command
"_usage_"            # usage error</code></pre>
</div></div>
</dd>
<dt class="hdlist1">
<code>"cmd_mode"</code>
</dt>
<dd>
<p>
        このイベントは、存在する場合、コマンド派生形(command variant)を記述します。このイベントは複数回発生する可能性があります。
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"cmd_mode",
        ...
        "name":"branch"
}</code></pre>
</div></div>
<div class="paragraph"><p>「name」フィールドは、コマンドモードを説明する任意の文字列です。たとえば、checkoutは、ブランチまたは個々のファイルをチェックアウトできます。 そして、これらのバリエーションは通常、比較できない異なるパフォーマンス特性を持っています。</p></div>
</dd>
<dt class="hdlist1">
<code>"alias"</code>
</dt>
<dd>
<p>
        このイベントは、エイリアスが展開されたときに発生します。
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"alias",
        ...
        "alias":"l",             # registered alias
        "argv":["log","--graph"] # alias expansion
}</code></pre>
</div></div>
</dd>
<dt class="hdlist1">
<code>"child_start"</code>
</dt>
<dd>
<p>
        このイベントは、spawn されようとしている子プロセスについて説明します。
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"child_start",
        ...
        "child_id":2,
        "child_class":"?",
        "use_shell":false,
        "argv":["git","rev-list","--objects","--stdin","--not","--all","--quiet"]

        "hook_name":"&lt;hook_name&gt;"  # present when child_class is "hook"
        "cd":"&lt;path&gt;"              # present when cd is required
}</code></pre>
</div></div>
<div class="paragraph"><p>「child_id」フィールドを使用して、このchild_startを対応するchild_exitイベントと照合できます。</p></div>
<div class="paragraph"><p>「child_class」フィールドは、「editor」、「pager」、「transport/*」、「hook」などの大まかな分類です。 未分類の子達は「?」と分類されます。</p></div>
</dd>
<dt class="hdlist1">
<code>"child_exit"</code>
</dt>
<dd>
<p>
        このイベントは、 現在のプロセスが <code>waitpid()</code> からリターンし、 子プロセスから終了情報(exit information)を収集した後に生成されます。
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"child_exit",
        ...
        "child_id":2,
        "pid":14708,     # child PID
        "code":0,        # child exit-code
        "t_rel":0.110605 # observed run-time of child process
}</code></pre>
</div></div>
<div class="paragraph"><p>注意: 子プロセスのセッションIDは、現在の/生成した プロセスでは使用できないため、子のPIDは、後処理のヒントとしてここに報告されることに注意してください。 （ただし、子プロセスはセッションIDを持たないシェルスクリプトである可能性があるため、これはヒントにすぎません。）</p></div>
<div class="paragraph"><p>注意: <code>t_rel</code> フィールドには、 観測された子プロセスの実行時間が秒単位で含まれていることに注意してください(開始前の fork/exec/spawn と <code>waitpid()</code> 後の停止(stop)と、 OSプロセス作成のオーバーヘッドを含みます)。 したがって、 この時間は、 子プロセス自体によって報告される atexit 時間よりもわずかに長くなります。</p></div>
</dd>
<dt class="hdlist1">
<code>"child_ready"</code>
</dt>
<dd>
<p>
        このイベントは、 現在のプロセスがバックグラウンド・プロセスを開始し、 そのプロセスへのすべてのハンドルを解放した後に生成されます。
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"child_ready",
        ...
        "child_id":2,
        "pid":14708,     # child PID
        "ready":"ready", # child ready state
        "t_rel":0.110605 # observed run-time of child process
}</code></pre>
</div></div>
<div class="paragraph"><p>注意: 子プロセスのセッションIDは、現在の/生成した プロセスでは使用できないため、子のPIDは、後処理のヒントとしてここに報告されることに注意してください。 （ただし、子プロセスはセッションIDを持たないシェルスクリプトである可能性があるため、これはヒントにすぎません。）</p></div>
<div class="paragraph"><p>このイベントは、 子プロセスがバック・グラウンドで開始され、 起動して作業を開始するための少しの時間が与えられた後に生成されます。 親プロセスがまだ待機している間に子プロセスが正常に起動した場合、 <code>ready｀ フィールドの値は `ready</code> になります。 子プロセスの開始が遅すぎて親がタイムアウトした場合、フィールドの値は <code>timeout</code> になります。 子プロセスが起動しても親プロセスがプローブ(probe)できない場合、 フィールドの値は <code>error</code> になります。</p></div>
<div class="paragraph"><p>親プロセスがこのイベントを発行した後、 すべてのハンドルを子プロセスに解放し、 子プロセスをバック・グラウンド・デーモンとして扱います。 そのため、 子プロセスが最終的に起動を完了したとしても、 親プロセスは updated イベントを発行しません。</p></div>
<div class="paragraph"><p>注意: <code>t_rel</code> フィールドには、親プロセスが子プロセスをバック・グラウンドに解放したときに観測された実行時間が秒単位で含まれていることに注意してください。 子プロセスは実行時間の長いデーモン・プロセスであると見なされ、 親プロセスよりも長く存続する可能性があります。 したがって、 親プロセスの 子イベント時間(child event times)は、 子プロセスの atexit 時間と比較されるべきではありません。</p></div>
</dd>
<dt class="hdlist1">
<code>"exec"</code>
</dt>
<dd>
<p>
        このイベントは、gitが子プロセスを開始するのではなく、別のコマンドを <code>exec()</code> しようとする前に生成されます。
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"exec",
        ...
        "exec_id":0,
        "exe":"git",
        "argv":["foo", "bar"]
}</code></pre>
</div></div>
<div class="paragraph"><p>「exec_id」フィールドはコマンド固有のIDであり、 <code>exec()</code> が失敗し、対応するexec_resultイベントが生成された場合にのみ役立ちます。</p></div>
</dd>
<dt class="hdlist1">
<code>"exec_result"</code>
</dt>
<dd>
<p>
        このイベントは、 <code>exec()</code> が失敗し、制御が現在のgitコマンドに戻った場合に生成されます。
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"exec_result",
        ...
        "exec_id":0,
        "code":1      # error code (errno) from exec()
}</code></pre>
</div></div>
</dd>
<dt class="hdlist1">
<code>"thread_start"</code>
</dt>
<dd>
<p>
        This event is generated when a thread is started. It is generated from <strong>within</strong> the new thread&#8217;s thread-proc (because it needs to access data in the thread&#8217;s thread-local storage).
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"thread_start",
        ...
        "thread":"th02:preload_thread" # thread name
}</code></pre>
</div></div>
</dd>
<dt class="hdlist1">
<code>"thread_exit"</code>
</dt>
<dd>
<p>
        This event is generated when a thread exits. It is generated from <strong>within</strong> the thread&#8217;s thread-proc.
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"thread_exit",
        ...
        "thread":"th02:preload_thread", # thread name
        "t_rel":0.007328                # thread elapsed time
}</code></pre>
</div></div>
</dd>
<dt class="hdlist1">
<code>"def_param"</code>
</dt>
<dd>
<p>
        このイベントは、構成設定、コマンドラインフラグ、環境変数などのグローバルパラメーターをログに記録するために生成されます。
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"def_param",
        ...
        "scope":"global",
        "param":"core.abbrev",
        "value":"7"
}</code></pre>
</div></div>
</dd>
<dt class="hdlist1">
<code>"def_repo"</code>
</dt>
<dd>
<p>
        このイベントはリポジトリIDを定義し、それをワークツリーのルートに関連付けます。
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"def_repo",
        ...
        "repo":1,
        "worktree":"/Users/jeffhost/work/gfw"
}</code></pre>
</div></div>
<div class="paragraph"><p>前述のように、リポジトリIDは現在常に1であるため、def_repoイベントは1つだけになります。その後、インプロセスサブモジュールがサポートされている場合、アクセスしたサブモジュールごとにdef_repoイベントを発行する必要があります。</p></div>
</dd>
<dt class="hdlist1">
<code>"region_enter"</code>
</dt>
<dd>
<p>
        このイベントは、リージョンに入るときに生成されます。
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"region_enter",
        ...
        "repo":1,                # optional
        "nesting":1,             # current region stack depth
        "category":"index",      # optional
        "label":"do_read_index", # optional
        "msg":".git/index"       # optional
}</code></pre>
</div></div>
<div class="paragraph"><p><code>category</code> フィールドは、カテゴリベースのフィルタリングを行うための、将来の拡張機能で使用される可能性があります。</p></div>
<div class="paragraph"><p><code>GIT_TRACE2_EVENT_NESTING</code> または <code>trace2.eventNesting</code> を使用して、深くネストされた領域とデータイベントをフィルタリングできます。 デフォルトは「2」です。</p></div>
</dd>
<dt class="hdlist1">
<code>"region_leave"</code>
</dt>
<dd>
<p>
        このイベントは、リージョンを離れるときに生成されます。
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"region_leave",
        ...
        "repo":1,                # optional
        "t_rel":0.002876,        # time spent in region in seconds
        "nesting":1,             # region stack depth
        "category":"index",      # optional
        "label":"do_read_index", # optional
        "msg":".git/index"       # optional
}</code></pre>
</div></div>
</dd>
<dt class="hdlist1">
<code>"data"</code>
</dt>
<dd>
<p>
        このイベントは、 thread-local と region-local の キー/値 のペアをログに記録するために生成されます。
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"data",
        ...
        "repo":1,              # optional
        "t_abs":0.024107,      # absolute elapsed time
        "t_rel":0.001031,      # elapsed time in region/thread
        "nesting":2,           # region stack depth
        "category":"index",
        "key":"read/cache_nr",
        "value":"3552"
}</code></pre>
</div></div>
<div class="paragraph"><p>「value」フィールドは整数または文字列です。</p></div>
</dd>
<dt class="hdlist1">
<code>"data-json"</code>
</dt>
<dd>
<p>
        このイベントは、構造化データを含む事前にフォーマットされたJSON文字列をログに記録するために生成されます。
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"data_json",
        ...
        "repo":1,              # optional
        "t_abs":0.015905,
        "t_rel":0.015905,
        "nesting":1,
        "category":"process",
        "key":"windows/ancestry",
        "value":["bash.exe","bash.exe"]
}</code></pre>
</div></div>
</dd>
<dt class="hdlist1">
<code>"th_timer"</code>
</dt>
<dd>
<p>
        This event logs the amount of time that a stopwatch timer was running in the thread. This event is generated when a thread exits for timers that requested per-thread events.
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"th_timer",
        ...
        "category":"my_category",
        "name":"my_timer",
        "intervals":5,         # number of time it was started/stopped
        "t_total":0.052741,    # total time in seconds it was running
        "t_min":0.010061,      # shortest interval
        "t_max":0.011648       # longest interval
}</code></pre>
</div></div>
</dd>
<dt class="hdlist1">
<code>"timer"</code>
</dt>
<dd>
<p>
        This event logs the amount of time that a stopwatch timer was running aggregated across all threads. This event is generated when the process exits.
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"timer",
        ...
        "category":"my_category",
        "name":"my_timer",
        "intervals":5,         # number of time it was started/stopped
        "t_total":0.052741,    # total time in seconds it was running
        "t_min":0.010061,      # shortest interval
        "t_max":0.011648       # longest interval
}</code></pre>
</div></div>
</dd>
<dt class="hdlist1">
<code>"th_counter"</code>
</dt>
<dd>
<p>
        This event logs the value of a counter variable in a thread. This event is generated when a thread exits for counters that requested per-thread events.
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"th_counter",
        ...
        "category":"my_category",
        "name":"my_counter",
        "count":23
}</code></pre>
</div></div>
</dd>
<dt class="hdlist1">
<code>"counter"</code>
</dt>
<dd>
<p>
        This event logs the value of a counter variable across all threads. This event is generated when the process exits. The total value reported here is the sum across all threads.
</p>
<div class="listingblock">
<div class="content">
<pre><code>{
        "event":"counter",
        ...
        "category":"my_category",
        "name":"my_counter",
        "count":23
}</code></pre>
</div></div>
</dd>
</dl></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example_trace2_api_usage">Example Trace2 API Usage</h2>
<div class="sectionbody">
<div class="paragraph"><p>これは、意図された使用法を示すTrace2 APIの仮想的な使用法です(実際のGitの詳細を気にする必要はありません)。</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
Initialization
</dt>
<dd>
<p>
        初期化は <code>main()</code> で行われます。 舞台裏では、 <code>atexit</code> と <code>signal</code> ハンドラーが登録されています。
</p>
<div class="listingblock">
<div class="content">
<pre><code>int main(int argc, const char **argv)
{
        int exit_code;

        trace2_initialize();
        trace2_cmd_start(argv);

        exit_code = cmd_main(argc, argv);

        trace2_cmd_exit(exit_code);

        return exit_code;
}</code></pre>
</div></div>
</dd>
<dt class="hdlist1">
Command Details
</dt>
<dd>
<p>
        基本が確立された後、追加のコマンド情報が検出されたときにTrace2に送信できます。
</p>
<div class="listingblock">
<div class="content">
<pre><code>int cmd_checkout(int argc, const char **argv)
{
        trace2_cmd_name("checkout");
        trace2_cmd_mode("branch");
        trace2_def_repo(the_repository);

        // emit "def_param" messages for "interesting" config settings.
        trace2_cmd_list_config();

        if (do_something())
            trace2_cmd_error("Path '%s': cannot do something", path);

        return 0;
}</code></pre>
</div></div>
</dd>
<dt class="hdlist1">
Child Processes
</dt>
<dd>
<p>
        子プロセスを生成するコードをラップします。
</p>
<div class="listingblock">
<div class="content">
<pre><code>void run_child(...)
{
        int child_exit_code;
        struct child_process cmd = CHILD_PROCESS_INIT;
        ...
        cmd.trace2_child_class = "editor";

        trace2_child_start(&amp;cmd);
        child_exit_code = spawn_child_and_wait_for_it();
        trace2_child_exit(&amp;cmd, child_exit_code);
}</code></pre>
</div></div>
<div class="paragraph"><p>たとえば、以下のfetchコマンドは、sshとindex-packとrev-listとgcをspawnしました。この例は、fetchに5.199秒かかり、そのうち4.932がsshであったことも示しています。</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ export GIT_TRACE2_BRIEF=1
$ export GIT_TRACE2=~/log.normal
$ git fetch origin
...</code></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><code>$ cat ~/log.normal
version 2.20.1.vfs.1.1.47.g534dbe1ad1
start git fetch origin
worktree /Users/jeffhost/work/gfw
cmd_name fetch (fetch)
child_start[0] ssh git@github.com ...
child_start[1] git index-pack ...
... (Trace2 events from child processes omitted)
child_exit[1] pid:14707 code:0 elapsed:0.076353
child_exit[0] pid:14706 code:0 elapsed:4.931869
child_start[2] git rev-list ...
... (Trace2 events from child process omitted)
child_exit[2] pid:14708 code:0 elapsed:0.110605
child_start[3] git gc --auto
... (Trace2 events from child process omitted)
child_exit[3] pid:14709 code:0 elapsed:0.006240
exit elapsed:5.198503 code:0
atexit elapsed:5.198541 code:0</code></pre>
</div></div>
<div class="paragraph"><p>gitプロセスが別のgitプロセスの(直接または間接の)子である場合、Trace2コンテキスト情報を継承します。これにより、子はコマンド階層を印刷できます。この例は、gcをfetchのchild[3]として示しています。 gcプロセスがその名前を「gc」として報告する場合、階層も「fetch/gc」として報告します。 （この例では、子プロセスからのtrace2メッセージはわかりやすくするためにインデントされています。）</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ export GIT_TRACE2_BRIEF=1
$ export GIT_TRACE2=~/log.normal
$ git fetch origin
...</code></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><code>$ cat ~/log.normal
version 2.20.1.160.g5676107ecd.dirty
start git fetch official
worktree /Users/jeffhost/work/gfw
cmd_name fetch (fetch)
...
child_start[3] git gc --auto
    version 2.20.1.160.g5676107ecd.dirty
    start /Users/jeffhost/work/gfw/git gc --auto
    worktree /Users/jeffhost/work/gfw
    cmd_name gc (fetch/gc)
    exit elapsed:0.001959 code:0
    atexit elapsed:0.001997 code:0
child_exit[3] pid:20303 code:0 elapsed:0.007564
exit elapsed:3.868938 code:0
atexit elapsed:3.868970 code:0</code></pre>
</div></div>
</dd>
<dt class="hdlist1">
Regions
</dt>
<dd>
<p>
        リージョンは、コードの興味深いセクションの時間を計るために使用できます。
</p>
<div class="listingblock">
<div class="content">
<pre><code>void wt_status_collect(struct wt_status *s)
{
        trace2_region_enter("status", "worktrees", s-&gt;repo);
        wt_status_collect_changes_worktree(s);
        trace2_region_leave("status", "worktrees", s-&gt;repo);

        trace2_region_enter("status", "index", s-&gt;repo);
        wt_status_collect_changes_index(s);
        trace2_region_leave("status", "index", s-&gt;repo);

        trace2_region_enter("status", "untracked", s-&gt;repo);
        wt_status_collect_untracked(s);
        trace2_region_leave("status", "untracked", s-&gt;repo);
}

void wt_status_print(struct wt_status *s)
{
        trace2_region_enter("status", "print", s-&gt;repo);
        switch (s-&gt;status_format) {
            ...
        }
        trace2_region_leave("status", "print", s-&gt;repo);
}</code></pre>
</div></div>
<div class="paragraph"><p>この例では、追跡していないファイルのスキャンは +0.012568 から +0.027149 まで実行され、(プロセスが開始されてから) 0.014581秒かかりました。</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ export GIT_TRACE2_PERF_BRIEF=1
$ export GIT_TRACE2_PERF=~/log.perf
$ git status
...

$ cat ~/log.perf
d0 | main                     | version      |     |           |           |            | 2.20.1.160.g5676107ecd.dirty
d0 | main                     | start        |     |  0.001173 |           |            | git status
d0 | main                     | def_repo     | r1  |           |           |            | worktree:/Users/jeffhost/work/gfw
d0 | main                     | cmd_name     |     |           |           |            | status (status)
...
d0 | main                     | region_enter | r1  |  0.010988 |           | status     | label:worktrees
d0 | main                     | region_leave | r1  |  0.011236 |  0.000248 | status     | label:worktrees
d0 | main                     | region_enter | r1  |  0.011260 |           | status     | label:index
d0 | main                     | region_leave | r1  |  0.012542 |  0.001282 | status     | label:index
d0 | main                     | region_enter | r1  |  0.012568 |           | status     | label:untracked
d0 | main                     | region_leave | r1  |  0.027149 |  0.014581 | status     | label:untracked
d0 | main                     | region_enter | r1  |  0.027411 |           | status     | label:print
d0 | main                     | region_leave | r1  |  0.028741 |  0.001330 | status     | label:print
d0 | main                     | exit         |     |  0.028778 |           |            | code:0
d0 | main                     | atexit       |     |  0.028809 |           |            | code:0</code></pre>
</div></div>
<div class="paragraph"><p>リージョンはネストできます。 これにより、たとえば、メッセージがPERFターゲットでインデントされます。 経過時間は、期待どおり、対応するネストレベルの開始を基準にしています。 たとえば、リージョンメッセージを以下の場所に追加するとします:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>static enum path_treatment read_directory_recursive(struct dir_struct *dir,
        struct index_state *istate, const char *base, int baselen,
        struct untracked_cache_dir *untracked, int check_only,
        int stop_at_first_file, const struct pathspec *pathspec)
{
        enum path_treatment state, subdir_state, dir_state = path_none;

        trace2_region_enter_printf("dir", "read_recursive", NULL, "%.*s", baselen, base);
        ...
        trace2_region_leave_printf("dir", "read_recursive", NULL, "%.*s", baselen, base);
        return dir_state;
}</code></pre>
</div></div>
<div class="paragraph"><p>追跡していないファイルのスキャンに費やされた時間をさらに調査できます。</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ export GIT_TRACE2_PERF_BRIEF=1
$ export GIT_TRACE2_PERF=~/log.perf
$ git status
...
$ cat ~/log.perf
d0 | main                     | version      |     |           |           |            | 2.20.1.162.gb4ccea44db.dirty
d0 | main                     | start        |     |  0.001173 |           |            | git status
d0 | main                     | def_repo     | r1  |           |           |            | worktree:/Users/jeffhost/work/gfw
d0 | main                     | cmd_name     |     |           |           |            | status (status)
...
d0 | main                     | region_enter | r1  |  0.015047 |           | status     | label:untracked
d0 | main                     | region_enter |     |  0.015132 |           | dir        | ..label:read_recursive
d0 | main                     | region_enter |     |  0.016341 |           | dir        | ....label:read_recursive vcs-svn/
d0 | main                     | region_leave |     |  0.016422 |  0.000081 | dir        | ....label:read_recursive vcs-svn/
d0 | main                     | region_enter |     |  0.016446 |           | dir        | ....label:read_recursive xdiff/
d0 | main                     | region_leave |     |  0.016522 |  0.000076 | dir        | ....label:read_recursive xdiff/
d0 | main                     | region_enter |     |  0.016612 |           | dir        | ....label:read_recursive git-gui/
d0 | main                     | region_enter |     |  0.016698 |           | dir        | ......label:read_recursive git-gui/po/
d0 | main                     | region_enter |     |  0.016810 |           | dir        | ........label:read_recursive git-gui/po/glossary/
d0 | main                     | region_leave |     |  0.016863 |  0.000053 | dir        | ........label:read_recursive git-gui/po/glossary/
...
d0 | main                     | region_enter |     |  0.031876 |           | dir        | ....label:read_recursive builtin/
d0 | main                     | region_leave |     |  0.032270 |  0.000394 | dir        | ....label:read_recursive builtin/
d0 | main                     | region_leave |     |  0.032414 |  0.017282 | dir        | ..label:read_recursive
d0 | main                     | region_leave | r1  |  0.032454 |  0.017407 | status     | label:untracked
...
d0 | main                     | exit         |     |  0.034279 |           |            | code:0
d0 | main                     | atexit       |     |  0.034322 |           |            | code:0</code></pre>
</div></div>
<div class="paragraph"><p>Trace2リージョンは、既存の trace_performance_enter() と trace_performance_leave()ルーチンに似ていますが、スレッドセーフであり、タイマーのスレッドごとのスタックを維持します。</p></div>
</dd>
<dt class="hdlist1">
Data Messages
</dt>
<dd>
<p>
        リージョンに追加されたデータメッセージ。
</p>
<div class="listingblock">
<div class="content">
<pre><code>int read_index_from(struct index_state *istate, const char *path,
        const char *gitdir)
{
        trace2_region_enter_printf("index", "do_read_index", the_repository, "%s", path);

        ...

        trace2_data_intmax("index", the_repository, "read/version", istate-&gt;version);
        trace2_data_intmax("index", the_repository, "read/cache_nr", istate-&gt;cache_nr);

        trace2_region_leave_printf("index", "do_read_index", the_repository, "%s", path);
}</code></pre>
</div></div>
<div class="paragraph"><p>この例は、インデックスに3552エントリが含まれていることを示しています。</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ export GIT_TRACE2_PERF_BRIEF=1
$ export GIT_TRACE2_PERF=~/log.perf
$ git status
...
$ cat ~/log.perf
d0 | main                     | version      |     |           |           |            | 2.20.1.156.gf9916ae094.dirty
d0 | main                     | start        |     |  0.001173 |           |            | git status
d0 | main                     | def_repo     | r1  |           |           |            | worktree:/Users/jeffhost/work/gfw
d0 | main                     | cmd_name     |     |           |           |            | status (status)
d0 | main                     | region_enter | r1  |  0.001791 |           | index      | label:do_read_index .git/index
d0 | main                     | data         | r1  |  0.002494 |  0.000703 | index      | ..read/version:2
d0 | main                     | data         | r1  |  0.002520 |  0.000729 | index      | ..read/cache_nr:3552
d0 | main                     | region_leave | r1  |  0.002539 |  0.000748 | index      | label:do_read_index .git/index
...</code></pre>
</div></div>
</dd>
<dt class="hdlist1">
Thread Events
</dt>
<dd>
<p>
        thread-procに追加されたスレッドメッセージ。
</p>
<div class="paragraph"><p>例えば、 マルチスレッドの preload-index コードは、 スレッドプール周辺の領域を計装し(instrumented)、 スレッド・プロセス(thread-proc)内でスレッドごとの開始と終了イベントを行うことができます。</p></div>
<div class="listingblock">
<div class="content">
<pre><code>static void *preload_thread(void *_data)
{
        // start the per-thread clock and emit a message.
        trace2_thread_start("preload_thread");

        // report which chunk of the array this thread was assigned.
        trace2_data_intmax("index", the_repository, "offset", p-&gt;offset);
        trace2_data_intmax("index", the_repository, "count", nr);

        do {
            ...
        } while (--nr &gt; 0);
        ...

        // report elapsed time taken by this thread.
        trace2_thread_exit();
        return NULL;
}

void preload_index(struct index_state *index,
        const struct pathspec *pathspec,
        unsigned int refresh_flags)
{
        trace2_region_enter("index", "preload", the_repository);

        for (i = 0; i &lt; threads; i++) {
            ... /* create thread */
        }

        for (i = 0; i &lt; threads; i++) {
            ... /* join thread */
        }

        trace2_region_leave("index", "preload", the_repository);
}</code></pre>
</div></div>
<div class="paragraph"><p>この例では、 preload_index()が <code>main</code> スレッドによって実行され、 <code>preload</code> リージョンを開始しました。 <code>th01:preload_thread</code> から <code>th07:preload_thread</code> という名前の7つのスレッドが開始されました。各スレッドからのイベントは、発生時に共有ターゲットストリームにアトミックに追加されるため、他のスレッドに対してランダムな順序で表示される場合があります。 最後に、メインスレッドは各スレッドが終了するのを待って、リージョンを離れます。</p></div>
<div class="paragraph"><p>データイベントは、アクティブなスレッド名でタグ付けされます。 これらは、スレッドごとのパラメーターを報告するために使用されます。</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ export GIT_TRACE2_PERF_BRIEF=1
$ export GIT_TRACE2_PERF=~/log.perf
$ git status
...
$ cat ~/log.perf
...
d0 | main                     | region_enter | r1  |  0.002595 |           | index      | label:preload
d0 | th01:preload_thread      | thread_start |     |  0.002699 |           |            |
d0 | th02:preload_thread      | thread_start |     |  0.002721 |           |            |
d0 | th01:preload_thread      | data         | r1  |  0.002736 |  0.000037 | index      | offset:0
d0 | th02:preload_thread      | data         | r1  |  0.002751 |  0.000030 | index      | offset:2032
d0 | th03:preload_thread      | thread_start |     |  0.002711 |           |            |
d0 | th06:preload_thread      | thread_start |     |  0.002739 |           |            |
d0 | th01:preload_thread      | data         | r1  |  0.002766 |  0.000067 | index      | count:508
d0 | th06:preload_thread      | data         | r1  |  0.002856 |  0.000117 | index      | offset:2540
d0 | th03:preload_thread      | data         | r1  |  0.002824 |  0.000113 | index      | offset:1016
d0 | th04:preload_thread      | thread_start |     |  0.002710 |           |            |
d0 | th02:preload_thread      | data         | r1  |  0.002779 |  0.000058 | index      | count:508
d0 | th06:preload_thread      | data         | r1  |  0.002966 |  0.000227 | index      | count:508
d0 | th07:preload_thread      | thread_start |     |  0.002741 |           |            |
d0 | th07:preload_thread      | data         | r1  |  0.003017 |  0.000276 | index      | offset:3048
d0 | th05:preload_thread      | thread_start |     |  0.002712 |           |            |
d0 | th05:preload_thread      | data         | r1  |  0.003067 |  0.000355 | index      | offset:1524
d0 | th05:preload_thread      | data         | r1  |  0.003090 |  0.000378 | index      | count:508
d0 | th07:preload_thread      | data         | r1  |  0.003037 |  0.000296 | index      | count:504
d0 | th03:preload_thread      | data         | r1  |  0.002971 |  0.000260 | index      | count:508
d0 | th04:preload_thread      | data         | r1  |  0.002983 |  0.000273 | index      | offset:508
d0 | th04:preload_thread      | data         | r1  |  0.007311 |  0.004601 | index      | count:508
d0 | th05:preload_thread      | thread_exit  |     |  0.008781 |  0.006069 |            |
d0 | th01:preload_thread      | thread_exit  |     |  0.009561 |  0.006862 |            |
d0 | th03:preload_thread      | thread_exit  |     |  0.009742 |  0.007031 |            |
d0 | th06:preload_thread      | thread_exit  |     |  0.009820 |  0.007081 |            |
d0 | th02:preload_thread      | thread_exit  |     |  0.010274 |  0.007553 |            |
d0 | th07:preload_thread      | thread_exit  |     |  0.010477 |  0.007736 |            |
d0 | th04:preload_thread      | thread_exit  |     |  0.011657 |  0.008947 |            |
d0 | main                     | region_leave | r1  |  0.011717 |  0.009122 | index      | label:preload
...
d0 | main                     | exit         |     |  0.029996 |           |            | code:0
d0 | main                     | atexit       |     |  0.030027 |           |            | code:0</code></pre>
</div></div>
<div class="paragraph"><p>この例では、 preload リージョンに0.009122秒かかりました。 7つのスレッドは、インデックスのそれらの部分で動作するのに0.006069〜0.008947秒かかりました。 スレッド「th01」は、オフセット0で508個のアイテムを処理しました。 スレッド「th02」は、オフセット2032で508個のアイテムを処理しました。 スレッド「th04」は、オフセット508で508アイテムを処理しました。</p></div>
<div class="paragraph"><p>This example also shows that thread names are assigned in a racy manner as each thread starts.</p></div>
</dd>
<dt class="hdlist1">
Config (def param) Events
</dt>
<dd>
<p>
          「興味のある」構成値を trace2 ログにダンプします。
</p>
<div class="paragraph"><p>オプションで構成イベントを発行できます。 有効にする方法については、 <a href="../git-config.html">git-config(1)</a> の「trace2.configparams」を参照してください。</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ git config --system color.ui never
$ git config --global color.ui always
$ git config --local color.ui auto
$ git config --list --show-scope | grep 'color.ui'
system  color.ui=never
global  color.ui=always
local   color.ui=auto</code></pre>
</div></div>
<div class="paragraph"><p>次に、 <code>GIT_TRACE2_CONFIG_PARAMS</code> を使用して、 設定 <code>color.ui</code> を「興味深い」設定としてマークします:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ export GIT_TRACE2_PERF_BRIEF=1
$ export GIT_TRACE2_PERF=~/log.perf
$ export GIT_TRACE2_CONFIG_PARAMS=color.ui
$ git version
...
$ cat ~/log.perf
d0 | main                     | version      |     |           |           |              | ...
d0 | main                     | start        |     |  0.001642 |           |              | /usr/local/bin/git version
d0 | main                     | cmd_name     |     |           |           |              | version (version)
d0 | main                     | def_param    |     |           |           | scope:system | color.ui:never
d0 | main                     | def_param    |     |           |           | scope:global | color.ui:always
d0 | main                     | def_param    |     |           |           | scope:local  | color.ui:auto
d0 | main                     | data         | r0  |  0.002100 |  0.002100 | fsync        | fsync/writeout-only:0
d0 | main                     | data         | r0  |  0.002126 |  0.002126 | fsync        | fsync/hardware-flush:0
d0 | main                     | exit         |     |  0.000470 |           |              | code:0
d0 | main                     | atexit       |     |  0.000477 |           |              | code:0</code></pre>
</div></div>
</dd>
<dt class="hdlist1">
Stopwatch Timer Events
</dt>
<dd>
<p>
        Measure the time spent in a function call or span of code that might be called from many places within the code throughout the life of the process.
</p>
<div class="listingblock">
<div class="content">
<pre><code>static void expensive_function(void)
{
        trace2_timer_start(TRACE2_TIMER_ID_TEST1);
        ...
        sleep_millisec(1000); // Do something expensive
        ...
        trace2_timer_stop(TRACE2_TIMER_ID_TEST1);
}

static int ut_100timer(int argc, const char **argv)
{
        ...

        expensive_function();

        // Do something else 1...

        expensive_function();

        // Do something else 2...

        expensive_function();

        return 0;
}</code></pre>
</div></div>
<div class="paragraph"><p>In this example, we measure the total time spent in <code>expensive_function()</code> regardless of when it is called in the overall flow of the program.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ export GIT_TRACE2_PERF_BRIEF=1
$ export GIT_TRACE2_PERF=~/log.perf
$ t/helper/test-tool trace2 100timer 3 1000
...
$ cat ~/log.perf
d0 | main                     | version      |     |           |           |              | ...
d0 | main                     | start        |     |  0.001453 |           |              | t/helper/test-tool trace2 100timer 3 1000
d0 | main                     | cmd_name     |     |           |           |              | trace2 (trace2)
d0 | main                     | exit         |     |  3.003667 |           |              | code:0
d0 | main                     | timer        |     |           |           | test         | name:test1 intervals:3 total:3.001686 min:1.000254 max:1.000929
d0 | main                     | atexit       |     |  3.003796 |           |              | code:0</code></pre>
</div></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_future_work">Future Work</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_relationship_to_the_existing_trace_api_api_trace_txt">Relationship to the Existing Trace Api (api-trace.txt)</h3>
<div class="paragraph"><p>Trace2に完全に切り替える前に、解決すべき問題がいくつかあります。</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>GIT_TRACE</code> 形式のメッセージを想定した既存のテストを更新します。
</p>
</li>
<li>
<p>
カスタム <code>GIT_TRACE_&lt;key&gt;</code> メッセージを最適に処理する方法は？
</p>
<div class="ulist"><ul>
<li>
<p>
<code>GIT_TRACE_&lt;key&gt;</code> メカニズムにより、各 &lt;key&gt; は(stderrだけでなく)異なるファイルに書き込むことができます。
</p>
</li>
<li>
<p>
その能力を維持したいのか、それとも単に既存のTrace2ターゲットに書き込みたいのか(そして &lt;key&gt; を「カテゴリ」に変換したいのか)。
</p>
</li>
</ul></div>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated
 2023-07-18 11:06:02 JST
</div>
</div>
</body>
</html>
