<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 9.1.1" />
<title>HTTP transfer protocols</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overridden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>HTTP transfer protocols</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>Git は、2 つの HTTP ベースの転送プロトコルをサポートしています。 接続するサーバー側で標準の HTTP
サーバーのみを必要とする「バカ」(dumb)プロトコルと、Git 対応の CGI (またはサーバーモジュール) を必要とする「スマート」プロトコルです。
このドキュメントでは、両方のプロトコルについて説明します。</p></div>
<div class="paragraph"><p>設計機能として、スマートクライアントは「バカ」(dumb)プロトコル URL をスマート URL に自動的にアップグレードできます。
これにより、すべてのユーザーが同じ URL を公開できるようになり、接続先(the
peers)では利用可能な最も効率的な転送方法(transport)を自動的に選択します。</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_url_format">URL Format</h2>
<div class="sectionbody">
<div class="paragraph"><p>HTTP によってアクセスされる Git リポジトリの URL は、RFC 1738 で文書化されている標準の HTTP URL
構文を使用するため、以下の形式になります:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>http://&lt;host&gt;:&lt;port&gt;/&lt;path&gt;?&lt;searchpart&gt;</code></pre>
</div></div>
<div class="paragraph"><p>このドキュメントでは、プレースホルダー <code>$GIT_URL</code> は、エンドユーザーが入力した  http:// リポジトリ URL を表すことにします。</p></div>
<div class="paragraph"><p>サーバーは、<code>$GIT_URL</code> に一致する場所へのすべてのリクエストを処理するべきです。 これは、Git
で使用される「スマート」および「バカ」(dumb) HTTP プロトコルの両方が、ユーザーが指定した <code>$GIT_URL</code>
文字列の末尾に追加のパスコンポーネントを追加することによって動作するためです。</p></div>
<div class="paragraph"><p>ルーズオブジェクトをリクエストするバカ(dumb)クライアントの例:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>$GIT_URL:     http://example.com:8080/git/repo.git
URL request:  http://example.com:8080/git/repo.git/objects/d0/49f6c27a2244e12041955e262a404c7faba355</code></pre>
</div></div>
<div class="paragraph"><p>キャッチオール(catch-all)ゲートウェイへのスマートリクエストの例:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>$GIT_URL:     http://example.com/daemon.cgi?svc=git&amp;q=
URL request:  http://example.com/daemon.cgi?svc=git&amp;q=/info/refs&amp;service=git-receive-pack</code></pre>
</div></div>
<div class="paragraph"><p>サブモジュール(submodule)へのリクエスト例:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>$GIT_URL:     http://example.com/git/repo.git/path/submodule.git
URL request:  http://example.com/git/repo.git/path/submodule.git/info/refs</code></pre>
</div></div>
<div class="paragraph"><p>クライアントは、サーバーに送信されるURLに空のパストークン(<code>//</code>)が表示されるのを防ぐために、ユーザーから与えられた $GIT_URL
文字列から、末尾に <code>/</code> がある場合はそれを削除しなければなりません。 互換性のあるクライアントは、<code>$GIT_URL/info/refs</code> を
<code>foo//info/refs</code> ではなく、<code>foo/info/refs</code> として展開しなｋればなりません。</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_authentication">Authentication</h2>
<div class="sectionbody">
<div class="paragraph"><p>リポジトリへのアクセスに認証が必要な場合は、標準の HTTP 認証が使用され、HTTPサーバーソフトウェアによって構成および強制される場合があります。</p></div>
<div class="paragraph"><p>Gitリポジトリは標準パスコンポーネントによってアクセスされるため、サーバー管理者はHTTPサーバー内でディレクトリベースのアクセス許可を使用して、リポジトリ
アクセスを制御できます。</p></div>
<div class="paragraph"><p>クライアントは、RFC 2617 で説明されているベーシック認証をサポートする必要があります。
サーバーは、Gitサーバーソフトウェアの前に置かれたHTTPサーバーに頼ってベーシック認証をサポートすべきです(SHOULD)。</p></div>
<div class="paragraph"><p>サーバーは、認証またはアクセス制御の目的で HTTP クッキーを要求すべきではありません。</p></div>
<div class="paragraph"><p>クライアントとサーバーは、ダイジェスト認証など、他の一般的なHTTPベースの認証形式をサポートする場合があります。</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_ssl">SSL</h2>
<div class="sectionbody">
<div class="paragraph"><p>クライアントとサーバーはSSLをサポートするべきです(SHOULD)。特に、ベーシック HTTP 認証に頼る場合にパスワードを保護するためです。</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_session_state">Session State</h2>
<div class="sectionbody">
<div class="paragraph"><p>Git over HTTP プロトコル (HTTP 自体とよく似ています) は、HTTP サーバー側から見るとステートレスです。
すべての状態は、クライアントプロセスによって保持および管理されなければなりません。
これにより、サーバー側で単純なラウンドロビン負荷分散が可能になり、状態管理について心配する必要がなくなります。</p></div>
<div class="paragraph"><p>クライアントは、正しく機能するためにサーバー側に状態管理を要求してはなりません。</p></div>
<div class="paragraph"><p>サーバーは、正しく機能するために HTTP Cookie を要求してはなりません。 クライアントは、RFC 2616 (HTTP/1.1)
で説明されているように、リクエスト処理中に HTTP Cookie を保存および転送できます。 サーバーは、クライアントから送信されたすべての
Cookie を無視する必要があります。</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_general_request_processing">General Request Processing</h2>
<div class="sectionbody">
<div class="paragraph"><p>特に明記されている場合を除き、すべての標準 HTTP 動作は、クライアントとサーバーの両方で想定される必要があります。
これには以下が含まれます(必ずしもこれらに限定されません):</p></div>
<div class="paragraph"><p>$GIT_URL にリポジトリがない場合、または $GIT_URL に一致する場所が指すリソースが存在しない場合、サーバーは <code>200 OK</code>
応答で応答してはいけません。 サーバーは、 <code>404 Not Found</code> または <code>410 Gone</code>
または要求どおりにリソースが存在することを意味しないその他の適切な HTTP ステータス コードで応答する必要があります。</p></div>
<div class="paragraph"><p>$GIT_URL にリポジトリがあるが、アクセスが現在許可されていない場合、サーバーは <code>403 Forbidden</code> HTTP ステータス
コードで応答しなければなりません。</p></div>
<div class="paragraph"><p>サーバーは、HTTP 1.0 と HTTP 1.1 の両方をサポートする必要があります。
サーバーは、リクエスト本文とレスポンス本文の両方でチャンクエンコーディングをサポートする必要があります。</p></div>
<div class="paragraph"><p>クライアントは、HTTP 1.0 と HTTP 1.1 の両方をサポートする必要があります。
クライアントは、リクエスト本文とレスポンス本文の両方でチャンクエンコーディングをサポートする必要があります。</p></div>
<div class="paragraph"><p>サーバは ETag かつ/または Last-Modified ヘッダー を返すことがあります。</p></div>
<div class="paragraph"><p>クライアントは、If-Modified-Since および/または If-None-Match
リクエストヘッダーを含めることにより、キャッシュされたエンティティを再検証することができます。</p></div>
<div class="paragraph"><p>関連するヘッダーがリクエストに表れ、エンティティが変更されていない場合、サーバーは <code>304 Not Modified</code> を返す場合があります。
クライアントは、キャッシュされたエンティティを再利用することにより、 <code>304 Not Modified</code> を <code>200 OK</code>
と同じように扱わなければいけません。</p></div>
<div class="paragraph"><p>Cache-Control および/または Expires
ヘッダーがキャッシュを許可する場合、クライアントは再検証なしでキャッシュされたエンティティを再利用できます。
クライアントとサーバーは、キャッシュ制御について RFC 2616 に従わなければなりません。</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_discovering_references">Discovering References</h2>
<div class="sectionbody">
<div class="paragraph"><p>すべての HTTP クライアントは、リモートリポジトリで利用可能な参照を検出して、フェッチまたはプッシュ交換を開始する必要があります。</p></div>
<div class="sect2">
<h3 id="_dumb_clients">Dumb Clients</h3>
<div class="paragraph"><p>「バカ」(dumb)プロトコルのみをサポートする HTTP クライアントは、リポジトリの特別な info/refs
ファイルをリクエストして、参照を検出する必要があります。</p></div>
<div class="paragraph"><p>バカ(dumb) HTTP クライアントは、検索/クエリ パラメータなしで、 <code>$GIT_URL/info/refs</code> に対して <code>GET</code>
リクエストを作成する必要があります。</p></div>
<div class="literalblock">
<div class="content">
<pre><code>C: GET $GIT_URL/info/refs HTTP/1.0</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>S: 200 OK
S:
S: 95dcfa3633004da0049d3d0fa03f80589cbcaf31  refs/heads/maint
S: d049f6c27a2244e12041955e262a404c7faba355  refs/heads/master
S: 2cb58b79488a98d2721cea644875a8dd0026b115  refs/tags/v1.0
S: a3c2e2402b99163d1d59756e5f207ae21cccba4c  refs/tags/v1.0^{}</code></pre>
</div></div>
<div class="paragraph"><p>返された info/refs エンティティの Content-Type は、 <code>text/plain charset=utf-8</code>
であるべきですが、任意の Content-Type である場合があります。 クライアントは、返された Content-Type
の検証を試みてはいけません。 バカ(dumb)サーバーは、 <code>application/x-git-</code> で始まる戻り値のタイプを返してはいけません。</p></div>
<div class="paragraph"><p>返されたエンティティのキャッシングを無効にするために、 Cache-Control ヘッダーが返される場合があります。</p></div>
<div class="paragraph"><p>応答クライアントを調べる場合、HTTP ステータス コードのみを調べる必要があります。 有効な応答は、 <code>200 OK</code> または <code>304 Not
Modified</code> です。</p></div>
<div class="paragraph"><p>返されるコンテンツは、各refとその既知の値を記述した UNIX 形式のテキストファイルです。 ファイルは、C
ロケールの順序に従って名前でソートする必要があります。 ファイルには、 <code>HEAD</code> という名前のデフォルトrefを含めるべきではありません。</p></div>
<div class="literalblock">
<div class="content">
<pre><code>info_refs   =  *( ref_record )
ref_record  =  any_ref / peeled_ref</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>any_ref     =  obj-id HTAB refname LF
peeled_ref  =  obj-id HTAB refname LF
               obj-id HTAB refname "^{}" LF</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_smart_clients">Smart Clients</h3>
<div class="paragraph"><p>「スマート」(smart)プロトコル (または「スマート」プロトコルと「バカ」(dumb)プロトコルの両方) をサポートする HTTP
クライアントは、リポジトリの info/refs ファイルに対してパラメーター化された要求を行うことにより、参照を検出する必要があります。</p></div>
<div class="paragraph"><p>リクエストには、<code>service=$servicename</code> というクエリパラメータが 1 つだけ含まれている必要があります。ここで、
<code>$servicename</code> は、クライアントが操作を完了するために接続したいサービス名でなければなりません。
リクエストに追加のクエリパラメータを含めてはいけません。</p></div>
<div class="literalblock">
<div class="content">
<pre><code>C: GET $GIT_URL/info/refs?service=git-upload-pack HTTP/1.0</code></pre>
</div></div>
<div class="paragraph"><p>バカ(dumb)サーバー返答:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>S: 200 OK
S:
S: 95dcfa3633004da0049d3d0fa03f80589cbcaf31  refs/heads/maint
S: d049f6c27a2244e12041955e262a404c7faba355  refs/heads/master
S: 2cb58b79488a98d2721cea644875a8dd0026b115  refs/tags/v1.0
S: a3c2e2402b99163d1d59756e5f207ae21cccba4c  refs/tags/v1.0^{}</code></pre>
</div></div>
<div class="paragraph"><p>スマートサーバー返答:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>S: 200 OK
S: Content-Type: application/x-git-upload-pack-advertisement
S: Cache-Control: no-cache
S:
S: 001e# service=git-upload-pack\n
S: 0000
S: 004895dcfa3633004da0049d3d0fa03f80589cbcaf31 refs/heads/maint\0multi_ack\n
S: 003fd049f6c27a2244e12041955e262a404c7faba355 refs/heads/master\n
S: 003c2cb58b79488a98d2721cea644875a8dd0026b115 refs/tags/v1.0\n
S: 003fa3c2e2402b99163d1d59756e5f207ae21cccba4c refs/tags/v1.0^{}\n
S: 0000</code></pre>
</div></div>
<div class="paragraph"><p>クライアントは、追加パラメーター(Extra Parameters)(Documentation/technical/pack-protocol.txt
参照) を、Git-Protocol HTTP ヘッダーでコロン(<code>:</code>)で区切られた文字列として送信できます。</p></div>
<div class="paragraph"><p>`--http-backend-info-refs@ オプションを <a href="../git-upload-pack.html">git-upload-pack(1)</a> に使用します。</p></div>
<div class="sect3">
<h4 id="_dumb_server_response">Dumb Server Response</h4>
<div class="paragraph"><p>バカ(dumb)サーバーは、バカサーバー応答形式(the dumb server reply format)で応答しなければなりません。</p></div>
<div class="paragraph"><p>バカ(dumb)サーバー応答の詳細な説明については、前述の「dumb clients」セクションを参照してください。</p></div>
</div>
<div class="sect3">
<h4 id="_smart_server_response">Smart Server Response</h4>
<div class="paragraph"><p>サーバーがリクエストされたサービス名を認識しない場合、またはリクエストされたサービス名がサーバー管理者によって無効にされている場合、サーバーは <code>403
Forbidden</code> HTTP ステータス コードで応答する必要があります。</p></div>
<div class="paragraph"><p>それ以外の場合、スマートサーバーは、リクエストされたサービス名のスマートサーバー返答形式(the smart server reply
format)で応答する必要があります。</p></div>
<div class="paragraph"><p>Cache-Control ヘッダーは、返されたエンティティのキャッシュを無効にするために使用する必要があります。</p></div>
<div class="paragraph"><p>Content-Type は <code>application/x-$servicename-advertisement</code> でなければなりません。
別のコンテンツタイプが返された場合、クライアントはバカ(dumb)プロトコルにフォールバックする必要があります。
バカ(dumb)プロトコルクライアントにフォールバックするとき、クライアントは <code>$GIT_URL/info/refs</code>
に追加のリクエストを行うべきではなく、代わりに既に手元にある応答を使用すべきです。
バカ(dumb)プロトコルをサポートしていない場合、クライアントは続行(continue)してはいけません。</p></div>
<div class="paragraph"><p>クライアントは、ステータスコードが <code>200 OK</code> または <code>304 Not Modified</code>
であることを検証(validate)する必要があります。</p></div>
<div class="paragraph"><p>クライアントは、応答エンティティの最初の 5 バイトが正規表現 <code>^[0-9a-f]{4}#</code>
とマッチすることを検証(validate)する必要があります。 このテストが失敗した場合、クライアントは続行(continue)してはいけません。</p></div>
<div class="paragraph"><p>クライアントは、応答全体を一連の pkt-line レコードとしてパースしなければなりません。</p></div>
<div class="paragraph"><p>クライアントは、最初の pkt-line が <code># service=$servicename</code> であることを確認(verify)する必要があります。
サーバーは $servicename をリクエストパラメータ値に設定する必要があります。 サーバーは、この行の最後に LF を含める必要があります。
クライアントは、行末の LF を無視する必要があります。</p></div>
<div class="paragraph"><p>サーバーは、魔法の <code>0000</code> pkt-line 終了マーカー(the magic <code>0000</code> end pkt-line
marker)で応答を終了する必要があります。</p></div>
<div class="paragraph"><p>返される応答は、各refとその既知の値を説明する pkt-line ストリームです。 ストリームは、C
ロケールの順序に従って名前でソートする必要があります。 ストリームには、最初のrefとして <code>HEAD</code>
という名前のデフォルトref照を含める必要があります。 ストリームは、最初のrefの NUL の後ろに機能宣言(capability
declarations)を含める必要があります。</p></div>
<div class="paragraph"><p>"version=1" が 追加パラメータ(Extra Parameter) として送信された場合、返される応答には "version 1"
が含まれます。</p></div>
<div class="literalblock">
<div class="content">
<pre><code>smart_reply     =  PKT-LINE("# service=$servicename" LF)
                   "0000"
                   *1("version 1")
                   ref_list
                   "0000"
ref_list        =  empty_list / non_empty_list</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>empty_list      =  PKT-LINE(zero-id SP "capabilities^{}" NUL cap-list LF)</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>non_empty_list  =  PKT-LINE(obj-id SP name NUL cap_list LF)
                   *ref_record</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>cap-list        =  capability *(SP capability)
capability      =  1*(LC_ALPHA / DIGIT / "-" / "_")
LC_ALPHA        =  %x61-7A</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>ref_record      =  any_ref / peeled_ref
any_ref         =  PKT-LINE(obj-id SP name LF)
peeled_ref      =  PKT-LINE(obj-id SP name LF)
                   PKT-LINE(obj-id SP name "^{}" LF</code></pre>
</div></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_smart_service_git_upload_pack">Smart Service git-upload-pack</h2>
<div class="sectionbody">
<div class="paragraph"><p>このサービスは、 <code>$GIT_URL</code> が指すリポジトリから読み込みます。</p></div>
<div class="paragraph"><p>クライアントは、最初に <code>$GIT_URL/info/refs?service=git-upload-pack</code> を使用して ref
検出を実行しなければなりません。</p></div>
<div class="literalblock">
<div class="content">
<pre><code>C: POST $GIT_URL/git-upload-pack HTTP/1.0
C: Content-Type: application/x-git-upload-pack-request
C:
C: 0032want 0a53e9ddeaddad63ad106860237bbf53411d11a7\n
C: 0032have 441b40d833fdfa93eb2908e52742248faf0ee993\n
C: 0000</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>S: 200 OK
S: Content-Type: application/x-git-upload-pack-result
S: Cache-Control: no-cache
S:
S: ....ACK %s, continue
S: ....NAK</code></pre>
</div></div>
<div class="paragraph"><p>クライアントは、キャッシュされた応答を再利用(reuse)または再検証(revalidate)してはなりません。
サーバーは、応答のキャッシュを防ぐために十分な Cache-Control ヘッダーを含める必要があります。</p></div>
<div class="paragraph"><p>サーバーは、ここで定義されたすべての機能をサポートすべきです。</p></div>
<div class="paragraph"><p>クライアントは、リクエスト本文で少なくとも 1 つの <code>want</code> コマンドを送信する必要があります。 サーバーが機能
<code>allow-tip-sha1-in-want</code> または <code>allow-reachable-sha1-in-want</code>
を宣伝(advertise)しない限り、クライアントは <code>want</code> コマンドで ref 検出によって取得された応答に表示されなかった ID
を参照してはいけません。</p></div>
<div class="literalblock">
<div class="content">
<pre><code>compute_request   =  want_list
                     have_list
                     request_end
request_end       =  "0000" / "done"</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>want_list         =  PKT-LINE(want SP cap_list LF)
                     *(want_pkt)
want_pkt          =  PKT-LINE(want LF)
want              =  "want" SP id
cap_list          =  capability *(SP capability)</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>have_list         =  *PKT-LINE("have" SP id LF)</code></pre>
</div></div>
<div class="paragraph"><p>TODO: 更に文書化する</p></div>
<div class="sect2">
<h3 id="_the_negotiation_algorithm">The Negotiation Algorithm</h3>
<div class="paragraph"><p>最小パックを選択するための計算は以下のように行われます(C = クライアント、S = サーバー):</p></div>
<div class="paragraph"><p><em>初期化ステップ:</em></p></div>
<div class="paragraph"><p>C: 広告されたref(advertised refs)を取得するためにref検出を使用します。</p></div>
<div class="paragraph"><p>C: 検出したオブジェクトを <code>advertised</code> セットに配置します。</p></div>
<div class="paragraph"><p>C: 後で両端にあると判断されるかもしれないオブジェクトを保持するために、
   空のセット <code>common</code> を作成します。</p></div>
<div class="paragraph"><p>C: ref検出中に発見したものに基づいて、クライアントが取得(fetch)したい
   <code>advertised</code> オブジェクトの <code>want</code> セットを構築します。</p></div>
<div class="paragraph"><p>C: コミット時間順に並べられたキュー <code>c_pending</code> を開始(最新のものを最初に取り出す(pop))。
   すべてのクライアントrefを追加します。
   コミットがキューから取り出される(pop)と、その親が自動的に挿入し直されます(SHOULD)。
   コミットがキューに入るのはは一度だけでなければなりません。</p></div>
<div class="paragraph"><p><em>1回分の計算ステップ:</em></p></div>
<div class="paragraph"><p>C: <code>$GIT_URL/git-upload-pack</code> リクエストを1つ送信します:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>C: 0032want &lt;want #1&gt;...............................
C: 0032want &lt;want #2&gt;...............................
....
C: 0032have &lt;common #1&gt;.............................
C: 0032have &lt;common #2&gt;.............................
....
C: 0032have &lt;have #1&gt;...............................
C: 0032have &lt;have #2&gt;...............................
....
C: 0000</code></pre>
</div></div>
<div class="paragraph"><p>ストリームは「コマンド群」に編成され、各コマンドは単独で pkt-line に表れれます。
コマンド行内では、最初の空白までのテキストがコマンド名であり、行の残りの最初の LF までが値です。 コマンド行は、 pkt-line
値の最後のバイトとしての LF で終了します。</p></div>
<div class="paragraph"><p>コマンド群がリクエストストリームに表れる場合、以下の順序でなければなりません:</p></div>
<div class="ulist"><ul>
<li>
<p>
"want"
</p>
</li>
<li>
<p>
"have"
</p>
</li>
</ul></div>
<div class="paragraph"><p>ストリームは pkt-line フラッシュ(<code>0000</code>)によって終了します。</p></div>
<div class="paragraph"><p>単一の <code>want</code> または <code>have</code> コマンドは、その値として 1 つの 16 進形式のオブジェクト名を持たなければなりません。
複数のオブジェクト名は複数のコマンドを送信する必要があります。 オブジェクト名は、 <code>object-format</code> 機能 (デフォルト SHA-1)
によってネゴシエートされたオブジェクトフォーマットを使用して与える必要があります。</p></div>
<div class="paragraph"><p><code>have</code> リストは、 <code>c_pending</code> から最初の 32 個のコミットを取り出す(pop)ことによって作成されます。 <code>c_pending</code>
が空である場合、供給できる量が少なくなります。</p></div>
<div class="paragraph"><p>クライアントが 256 の <code>have</code> コミットを送信し、 <code>s_common</code> からそれらの 1 つをまだ受信していない場合、またはクライアントが
<code>c_pending</code> を空にした場合、サーバーに続行しないことを知らせる <code>done</code> コマンドを含める必要があります:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>C: 0009done</code></pre>
</div></div>
<div class="paragraph"><p>S: git-upload-pack リクエストをパースする:</p></div>
<div class="paragraph"><p><code>want</code> 内のすべてのオブジェクトがrefから直に到達可能であることを確認(verify)します。</p></div>
<div class="paragraph"><p>サーバーは、履歴または reflog をさかのぼって、気持ち古いリクエストを許可する場合があります。</p></div>
<div class="paragraph"><p><code>want</code> オブジェクトが受信されない場合は、エラーを送信します:  TODO: <code>欲しい</code> 行がリクエストされていない場合はエラーを定義します。</p></div>
<div class="paragraph"><p><code>want</code> オブジェクトに到達できない場合は、エラーを送信します: TODO: 無効な <code>want</code> がリクエストされた場合はエラーを定義します。</p></div>
<div class="paragraph"><p>空のリスト <code>s_common</code> を作成します。</p></div>
<div class="paragraph"><p>もし <code>have</code> が送信されたら:</p></div>
<div class="paragraph"><p>クライアントから提供された順序でオブジェクトをループします。</p></div>
<div class="paragraph"><p>各オブジェクトについて、サーバーに ref から到達可能なオブジェクトがある場合は、それを <code>s_common</code> に追加します。 コミットが
s_common に追加された場合、祖先が have に含まれていても追加しないでください。</p></div>
<div class="paragraph"><p>S: git-upload-pack 応答を送信:</p></div>
<div class="paragraph"><p>サーバーがパックするオブジェクトの閉じたセットを見つけた場合、またはリクエストが <code>done</code> で終了した場合、サーバーはパックで応答します。
TODO: パックベースの応答を文書化する</p></div>
<div class="literalblock">
<div class="content">
<pre><code>S: PACK...</code></pre>
</div></div>
<div class="paragraph"><p>返されるストリームは、 git-upload-pack サービスでサポートされている side-band-64k プロトコルであり、パックはストリーム
1 に埋め込まれます。サーバー側からの進行状況メッセージは、ストリーム 2 に表示される場合があります。</p></div>
<div class="paragraph"><p>ここで、「オブジェクトの閉じたセット」(closed set of objects)とは、すべての <code>want</code> から少なくとも 1 つの
<code>common</code> オブジェクトへの少なくとも 1 つのパスを持つように定義されます。</p></div>
<div class="paragraph"><p>サーバーがさらに情報を必要とする場合、サーバーは status continue 応答で応答します: TODO: パック以外の応答を文書化する</p></div>
<div class="paragraph"><p>C: Parse the upload-pack response:
   TODO: Document parsing response</p></div>
<div class="paragraph"><p><em>次の回の計算ステップを実行します。</em></p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_smart_service_git_receive_pack">Smart Service git-receive-pack</h2>
<div class="sectionbody">
<div class="paragraph"><p>このサービスは、 <code>$GIT_URL</code> が指すリポジトリから読み込みます。</p></div>
<div class="paragraph"><p>クライアントは、最初に <code>$GIT_URL/info/refs?service=git-receive-pack</code> を使用して ref
検出を実行する必要があります。</p></div>
<div class="literalblock">
<div class="content">
<pre><code>C: POST $GIT_URL/git-receive-pack HTTP/1.0
C: Content-Type: application/x-git-receive-pack-request
C:
C: ....0a53e9ddeaddad63ad106860237bbf53411d11a7 441b40d833fdfa93eb2908e52742248faf0ee993 refs/heads/maint\0 report-status
C: 0000
C: PACK....</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>S: 200 OK
S: Content-Type: application/x-git-receive-pack-result
S: Cache-Control: no-cache
S:
S: ....</code></pre>
</div></div>
<div class="paragraph"><p>クライアントは、キャッシュされた応答を再利用(reuse)または再検証(revalidate)してはなりません。
サーバーは、応答のキャッシュを防ぐために十分な Cache-Control ヘッダーを含める必要があります。</p></div>
<div class="paragraph"><p>サーバーは、ここで定義されたすべての機能をサポートすべきです。</p></div>
<div class="paragraph"><p>クライアントは、リクエスト本文で少なくとも 1 つのコマンドを送信する必要があります。 リクエストボディのコマンド部分内で、クライアントは、ref
検出を通じて取得した ID を old_id として送信する必要があります。</p></div>
<div class="literalblock">
<div class="content">
<pre><code>update_request  =  command_list
                   "PACK" &lt;binary data&gt;</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>command_list    =  PKT-LINE(command NUL cap_list LF)
                   *(command_pkt)
command_pkt     =  PKT-LINE(command LF)
cap_list        =  *(SP capability) SP</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>command         =  create / delete / update
create          =  zero-id SP new_id SP name
delete          =  old_id SP zero-id SP name
update          =  old_id SP new_id SP name</code></pre>
</div></div>
<div class="paragraph"><p>TODO: 更に文書化する</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_references">References</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.ietf.org/rfc/rfc1738.txt">RFC 1738: Uniform Resource Locators
  (URL)</a>
</p>
</li>
<li>
<p>
<a href="http://www.ietf.org/rfc/rfc2616.txt">RFC 2616: Hypertext Transfer Protocol&#8201;&#8212;&#8201;  HTTP/1.1</a>
</p>
</li>
<li>
<p>
link:technical/pack-protocol.html
</p>
</li>
<li>
<p>
link:technical/protocol-capabilities.html
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated
 2022-09-04 21:44:12 JST
</div>
</div>
</body>
</html>
